# Руководство по использованию Risk Calculator

## Введение

Risk Calculator помогает трейдерам планировать сделки с множественными точками входа, автоматически рассчитывая:
- Среднюю цену позиции
- Риски и потенциальную прибыль
- Risk/Reward ratio
- Частичные сценарии для каждого входа

## Базовые настройки

### 1. Тикер
Введите название актива (например, BTC, ETH, AAPL). Это просто метка для вашей позиции.

### 2. Направление позиции
Выберите одно из двух:
- **Long** - ставка на рост цены
- **Short** - ставка на падение цены

Направление влияет на:
- Порядок исполнения входов
- Расчет прибыли/убытка

### 3. Стоп-лосс (Stop Loss)
Цена, при которой позиция закроется с убытком для ограничения рисков.

### 4. Тейк-профит (Take Profit)
Цена, при которой позиция закроется с прибылью.

## Работа с точками входа

### Добавление входа
Нажмите кнопку **"+ Добавить вход"** в правом верхнем углу настроек.

### Заполнение данных входа
Для каждой точки входа укажите:
1. **Цену входа** - по какой цене планируете открыть часть позиции
2. **Сумму (USDT)** - сколько денег вложить в этот вход

### Использование пресетов
Вместо ручного ввода суммы, можно использовать пресеты:
1. Настройте пресеты в верхней части таблицы (по умолчанию: 50, 100, 200, 500, 1000)
2. Нажмите на кнопку с нужной суммой рядом с входом
3. Сумма автоматически применится к выбранному входу

### Удаление входа
Нажмите красную кнопку **"✕"** в конце строки входа.

## Сортировка входов

Используйте кнопки сортировки над таблицей:

- **Исходный порядок** - восстанавливает порядок добавления входов
- **↑ По возрастанию** - сортирует по цене от меньшей к большей
- **↓ По убыванию** - сортирует по цене от большей к меньшей

**Важно:** Сортировка в таблице НЕ влияет на расчеты! Логика исполнения всегда следует правилу:
- Short: входы исполняются по возрастанию цены
- Long: входы исполняются по убыванию цены

## Понимание расчетов

### Сводка по позиции (верхняя карточка)
Показывает данные при исполнении ВСЕХ входов:

- **Средняя цена** - взвешенная средняя цена позиции
- **Общий объем** - суммарное количество актива
- **Общая сумма** - суммарные инвестиции в USDT
- **Риск (SL)** - убыток в $ при достижении стоп-лосса
- **Прибыль (TP)** - прибыль в $ при достижении тейк-профита
- **R/R** - соотношение риска к прибыли

### Частичные сценарии (строки таблицы)
Каждая строка показывает сценарий, если:
- Цена дошла до этого входа
- Цена НЕ дошла до следующих входов
- Затем цена пошла к тейк-профиту

Это помогает понять потенциальную прибыль на каждом этапе набора позиции.

## Валидация и предупреждения

Приложение автоматически проверяет корректность введенных данных и показывает предупреждения.

### Правила валидации

#### Для Short позиции:
- ✅ **Стоп-лосс** должен быть **ВЫШЕ** всех цен входа
- ✅ **Тейк-профит** должен быть **НИЖЕ** всех цен входа
- ✅ **Цены входа** должны быть между TP и SL

**Логика:** При шорте мы продаем актив. Если цена растет (против нас), мы усредняем позицию. Стоп-лосс устанавливается выше, чтобы ограничить убытки при росте цены.

#### Для Long позиции:
- ✅ **Стоп-лосс** должен быть **НИЖЕ** всех цен входа
- ✅ **Тейк-профит** должен быть **ВЫШЕ** всех цен входа
- ✅ **Цены входа** должны быть между SL и TP

**Логика:** При лонге мы покупаем актив. Если цена падает (против нас), мы усредняем позицию. Стоп-лосс устанавливается ниже, чтобы ограничить убытки при падении цены.

### Визуальные индикаторы

**Желтая рамка и предупреждение ⚠️** появляются когда:
- Стоп-лосс нарушает правила для текущего направления
- Тейк-профит нарушает правила для текущего направления
- Цена входа находится вне допустимого диапазона

**Пример неправильной конфигурации для Short:**
```
❌ Неправильно:
Направление: Short
Входы: 90000, 91000, 92000
Стоп-лосс: 92000  ⚠️ Должен быть выше 92000!
Тейк-профит: 85000  ✓

✓ Правильно:
Направление: Short
Входы: 90000, 91000, 92000
Стоп-лосс: 93000  ✓
Тейк-профит: 85000  ✓
```

**Пример неправильной конфигурации для Long:**
```
❌ Неправильно:
Направление: Long
Входы: 3000, 2950, 2900
Стоп-лосс: 2900  ⚠️ Должен быть ниже 2900!
Тейк-профит: 3500  ✓

✓ Правильно:
Направление: Long
Входы: 3000, 2950, 2900
Стоп-лосс: 2800  ✓
Тейк-профит: 3500  ✓
```

### Почему это важно?

Если стоп-лосс установлен неправильно:
- **Short:** Если SL ≤ максимального входа, позиция закроется сразу при исполнении этого входа
- **Long:** Если SL ≥ минимального входа, позиция закроется сразу при исполнении этого входа

**Результат:** Вы получите убыток без возможности усреднения!

## Примеры использования

### Пример 1: Short позиция на BTC

**Настройки:**
- Тикер: BTC
- Направление: Short
- Стоп-лосс: 93000
- Тейк-профит: 85000

**Входы:**
1. Цена: 90000, Сумма: 100 USDT
2. Цена: 91000, Сумма: 100 USDT
3. Цена: 92000, Сумма: 200 USDT

**Логика:**
- Первый вход исполнится при цене 90000
- Если цена продолжит расти до 91000 - исполнится второй вход (усредним позицию)
- Если цена достигнет 92000 - исполнится третий вход (ещё больше усредним)
- Если цена продолжит рост выше 92000 и достигнет 93000 - сработает стоп-лосс
- Если цена развернется к 85000 - сработает тейк-профит

**Частичные сценарии:**
1. **Только первый вход (90000):** 
   - Средняя цена = 90000
   - Если цена развернется и пойдет к 85000, прибыль будет меньше
   
2. **Первый + второй вход (90000 + 91000):**
   - Средняя цена ≈ 90495
   - Прибыль будет больше, т.к. позиция увеличена
   
3. **Все три входа:**
   - Средняя цена еще выше
   - Максимальная прибыль при достижении TP

### Пример 2: Long позиция на ETH

**Настройки:**
- Тикер: ETH
- Направление: Long
- Стоп-лосс: 2800
- Тейк-профит: 3500

**Входы:**
1. Цена: 3000, Сумма: 200 USDT
2. Цена: 2950, Сумма: 200 USDT
3. Цена: 2900, Сумма: 400 USDT

**Логика:**
- Для Long входы исполняются по убыванию: 3000 → 2950 → 2900
- Первый вход при 3000
- Если цена упадет до 2950 - усредним (второй вход)
- Если упадет до 2900 - еще больше усредним (третий вход)
- Если цена упадет ниже 2800 - стоп-лосс
- Если цена вырастет до 3500 - тейк-профит

## Индикаторы и предупреждения

### Risk/Reward Ratio (R/R)
- **R/R > 3** - отличное соотношение (потенциальная прибыль в 3+ раза больше риска)
- **R/R = 1-3** - приемлемое соотношение
- **R/R < 1** - риск больше потенциальной прибыли (требует внимания)

### Предупреждение о подозрительных значениях
Если R/R > 10 или R/R < 0.2, приложение покажет желтое предупреждение ⚠️.
Это может означать:
- Опечатку в данных
- Слишком агрессивную или консервативную стратегию
- Ошибку в настройке SL/TP

## Математика расчетов

### Средняя цена позиции
```
Для каждого входа:
quantity_i = amount_i / price_i

Средняя цена = Σ(amount_i) / Σ(quantity_i)
```

### PnL (прибыль/убыток)
**Long:**
```
PnL = (ExitPrice - AvgPrice) × TotalQuantity
```

**Short:**
```
PnL = (AvgPrice - ExitPrice) × TotalQuantity
```

### Процент движения
**Long:**
```
До SL% = (AvgPrice - StopLoss) / AvgPrice × 100
До TP% = (TakeProfit - AvgPrice) / AvgPrice × 100
```

**Short:**
```
До SL% = (StopLoss - AvgPrice) / AvgPrice × 100
До TP% = (AvgPrice - TakeProfit) / AvgPrice × 100
```

## Советы по использованию

1. **Начните с простого**: Попробуйте 2-3 входа для начала
2. **Проверяйте R/R**: Старайтесь, чтобы R/R был минимум 1.5-2
3. **Учитывайте риски**: Не рискуйте более 1-2% капитала на одну позицию
4. **Используйте пресеты**: Настройте удобные вам размеры входов
5. **Анализируйте частичные сценарии**: Понимайте, что происходит на каждом этапе

## Ограничения

Текущая версия НЕ учитывает:
- Комиссии биржи
- Фандинговые ставки
- Плечо (leverage)
- Проскальзывание (slippage)

Все расчеты производятся для спотовой торговли без плеча.

## Часто задаваемые вопросы

**Q: Почему при Short входы исполняются по возрастанию?**
A: При шорте вы продаете актив. Если цена растет против вас, вы усредняете позицию, открывая новые входы по более высоким ценам.
Внимание! Используйте усреднения с умом. Обычно лучше закрыть позицию в убыток и перезайти позже. Но если очень нужно, используйте этот калькулятор. Он поможет вам контролировать риск, если вы планируете увеличивать позицию.

**Q: Можно ли сохранить расчеты?**
A: В текущей версии нет. Есть вероятность появления этой функции в будущих обновлениях, если будет соответствующая обратная связь от пользователей.

**Q: Работает ли калькулятор без интернета?**
A: Да, после загрузки страницы калькулятор работает полностью оффлайн.

**Q: Можно ли использовать дробные количества?**
A: Да, приложение поддерживает любые числа с плавающей точкой.
